<view class="container">
  <!-- ç”¨æˆ·ä¿¡æ¯å¡ç‰‡ -->
  <view class="user-card" wx:if="{{userInfo}}">
    <image class="avatar" src="{{userInfo.avatarUrl}}" mode="aspectFill"></image>
    <view class="user-info">
      <text class="nickname">{{userInfo.nickName}}</text>
      <text class="role">å†œæˆ·</text>
    </view>
    <view class="header-actions">
      <button class="btn-refresh" size="mini" bindtap="refreshData" disabled="{{loading}}">
        {{loading ? 'åŠ è½½ä¸­...' : 'åˆ·æ–°æ•°æ®'}}
      </button>
      <button class="btn-support" size="mini" bindtap="contactSupport">è”ç³»å®¢æœ</button>
    </view>
  </view>

  <!-- æ•°æ®ç»Ÿè®¡å¡ç‰‡ -->
  <view class="stats-cards">
    <view class="stat-card" bindtap="viewPendingQuotes">
      <text class="stat-number">{{stats.pendingQuotes || 0}}</text>
      <text class="stat-label">å¾…å¤„ç†æŠ¥ä»·</text>
    </view>
    <view class="stat-card" bindtap="viewActiveOrders">
      <text class="stat-number">{{stats.activeOrders || 0}}</text>
      <text class="stat-label">è¿›è¡Œä¸­è®¢å•</text>
    </view>
    <view class="stat-card" bindtap="viewAllOrders">
      <text class="stat-number">{{stats.completedOrders || 0}}</text>
      <text class="stat-label">å·²å®Œæˆè®¢å•</text>
    </view>
  </view>

  <!-- å¿«æ·ç»Ÿè®¡ -->
  <view class="quick-stats">
    <view class="stat-item" bindtap="viewPendingQuotes">
      <text class="stat-number">{{stats.pendingQuotes || 0}}</text>
      <text class="stat-label">å¾…å¤„ç†æŠ¥ä»·</text>
    </view>
    <view class="stat-item" bindtap="viewActiveOrders">
      <text class="stat-number">{{stats.activeOrders || 0}}</text>
      <text class="stat-label">è¿›è¡Œä¸­è®¢å•</text>
    </view>
  </view>

  <!-- å¿«æ·æ“ä½œ -->
  <view class="quick-actions">
    <view class="action-item" bindtap="publishDemand">
      <view class="action-icon">ğŸ“</view>
      <text class="action-text">å‘å¸ƒéœ€æ±‚</text>
    </view>
    <view class="action-item" bindtap="viewPendingQuotes">
      <view class="action-icon">ğŸ’¬</view>
      <text class="action-text">å¾…å¤„ç†æŠ¥ä»·</text>
      <view class="badge" wx:if="{{pendingQuotes > 0}}">{{pendingQuotes}}</view>
    </view>
  </view>

  <!-- å¾…å¤„ç†è®¢å• -->
  <view class="section" wx:if="{{pendingOrders.length > 0}}">
    <view class="section-header">
      <text class="section-title">å¾…å¤„ç†è®¢å•</text>
      <text class="section-count">{{pendingOrders.length}}</text>
    </view>
    <view class="order-list">
      <view
        class="order-item"
        wx:for="{{pendingOrders}}"
        wx:key="_id"
        bindtap="viewOrderDetail"
        data-order-id="{{item._id}}"
      >
        <view class="order-header">
          <text class="order-job">{{item.jobType}}</text>
          <text class="order-status {{item.status}}">
            {{item.status === 'pending' ? 'å¾…æŠ¥ä»·' : 'å·²æŠ¥ä»·'}}
          </text>
        </view>
        <view class="order-info">
          <text class="order-location">ğŸ“ {{item.location.address}}</text>
          <text class="order-price" wx:if="{{item.financials}}">
            {{item.financials.totalAmount / 100}} å…ƒ
          </text>
        </view>
        <view class="order-time">
          <text>{{item.timeline.createdAt}}</text>
        </view>
      </view>
    </view>
  </view>

  <!-- è¿›è¡Œä¸­è®¢å• -->
  <view class="section" wx:if="{{inProgressOrders.length > 0}}">
    <view class="section-header">
      <text class="section-title">è¿›è¡Œä¸­è®¢å•</text>
      <text class="section-count">{{inProgressOrders.length}}</text>
    </view>
    <view class="order-list">
      <view
        class="order-item"
        wx:for="{{inProgressOrders}}"
        wx:key="_id"
        bindtap="viewOrderDetail"
        data-order-id="{{item._id}}"
      >
        <view class="order-header">
          <text class="order-job">{{item.jobType}}</text>
          <text class="order-status {{item.status}}">
            {{item.status === 'confirmed' ? 'å·²ç¡®è®¤' : 'è¿›è¡Œä¸­'}}
          </text>
        </view>
        <view class="order-info">
          <text class="order-location">ğŸ“ {{item.location.address}}</text>
          <text class="order-price" wx:if="{{item.financials}}">
            {{item.financials.totalAmount / 100}} å…ƒ
          </text>
        </view>
        <view class="order-time">
          <text>{{item.timeline.startedAt || item.timeline.confirmedAt}}</text>
        </view>
      </view>
    </view>
  </view>

  <!-- ç©ºçŠ¶æ€ -->
  <view class="empty" wx:if="{{!loading && pendingOrders.length === 0 && inProgressOrders.length === 0}}">
    <text class="empty-text">æš‚æ— è®¢å•</text>
    <button class="empty-btn" bindtap="publishDemand">å‘å¸ƒç¬¬ä¸€ä¸ªéœ€æ±‚</button>
  </view>
</view>

